/******************************************************************************/
/* This file has been generated by the uGFX-Studio                            */
/*                                                                            */
/* http://ugfx.org                                                            */
/******************************************************************************/

#include "colors.h"
#include "widgetstyles.h"
#include "gui.h"
#include "trace.h"
#include "gps.h"
#include <stdio.h>
#include <string.h>

#define MAP_TILE_TEST_CANAL
//#define MAP_TILE_TEST_MAYTHAM
//#define MAP_TILE_TEST_JON

#define MAP_CENTERX 552
#define MAP_CENTERY 240

#define MAIN_CONTAINER 0
#define DATA_CONTAINER 1
#define MAP_CONTAINER 2
#define MENU_CONTAINER 3
#define BLUETOOTH_CONTAINER 4
#define BLUETOOTH_SEARCH_CONTAINER 5
#define BLUETOOTH_DEVICE_CONTAINER 6
#define GEARS_CONTAINER 7
#define TEETH_CONTAINER 8
#define STATUS_CONTAINER 9
#define CLOCK_CONTAINER 10

// GListeners
GListener glistener;

GHandle containers[11];
GHandle labels[6];
GHandle buttons[8];
GHandle lists[2];


GHandle ghImage1[10];

// GEAR STATUS SPECIALS
GHandle gearsChangesFrontGearLabel[MAXIMUM_FRONT_GEARS+1];
GHandle gearsChangesBackGearLabel[MAXIMUM_BACK_GEARS+1];
GHandle gearsCurrentFrontGearLabel[MAXIMUM_FRONT_GEARS+1];
GHandle gearsCurrentBackGearLabel[MAXIMUM_BACK_GEARS+1];

// CLOCK SPECIALS
GHandle clockChangesKey[5];
GHandle clockChangesValue[5];
uint8_t clockChangeSelectedItem;
uint8_t previousClockSelection;
#define MAXIMUM_MINUTES 59
#define MAXIMUM_HOUR 24
#define MAXIMUM_DAY 31
#define MAXIMUM_MONTH 12

typedef struct {
	uint8_t Minutes;     /*!< Minutes parameter, from 00 to 59 */
	uint8_t Hours;       /*!< Hours parameter, 24Hour mode, 00 to 23 */
	uint8_t Day;         /*!< Day in a month, 1 to 31 */
	uint8_t Month;       /*!< Month in a year, 1 to 12 */
	uint8_t Year;        /*!< Year parameter, 00 to 99, 00 is 2000 and 99 is 2099 */
} ClockChangesStruct;
ClockChangesStruct clockChangesStruct;
TM_RTC_t RTCD;

int gearFrontSettings[MAXIMUM_FRONT_GEARS+1];
int gearBackSettings[MAXIMUM_BACK_GEARS+1];
char gearBuffer[5];
char gearsStatus[26];

char timeBuffer[23];
char gpsOutput[70];

int currentGearSide;
int currentGearTeethWindow;
int currentTeethTeethWindow;
int oldMenuSelectedItem;

int speed;
char speedout[10];

static gdispImage myImage[9];
static gdispImage marker;
//gdispImageError result;
//int x = 0;
//int y = 0;
//static GDisplay* pixmap;
//static pixel_t* surface;


	int oldtilex=0;
	int oldtiley=0;


void drawTile(int tilex, int tiley, int tilexOffset, int tileyOffset);
void button0Call();
void button1Call();
void button2Call();
void button3Call();
void button4Call();
void button5Call();
void button6Call();
void button7Call();
void handleMenuSwitches();
	
static void createmainContainer(void)
{
	TRACE("createcreatemainContainer\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	// create container widget: containers[MAIN_CONTAINER]
	wi.g.show = FALSE;
	wi.g.x = 0;
	wi.g.y = 0;
	wi.g.width = 800;
	wi.g.height = 480;
	wi.g.parent = 0;
	wi.text = "containers[MAIN_CONTAINER]";
	wi.customDraw = 0;
	wi.customParam = 0;
	wi.customStyle = 0;
	containers[MAIN_CONTAINER] = gwinContainerCreate(0, &wi, 0);    
	
	// create container widget: containers[MAP_CONTAINER]
	wi.g.show = TRUE;
	wi.g.x = 305;
	wi.g.width = 495;
	wi.g.parent = containers[MAIN_CONTAINER];
	wi.text = "containers[MAP_CONTAINER]";
	containers[MAP_CONTAINER] = gwinContainerCreate(0, &wi, 0);
	
	// create container widget: containers[DATA_CONTAINER]
	wi.g.x = 0;
	wi.g.width = 305;
	wi.text = "Container";
	wi.customStyle = &midnight;
	containers[DATA_CONTAINER] = gwinContainerCreate(0, &wi, 0);
	
	// create container widget: containers[MENU_CONTAINER]
	wi.g.show = FALSE;
	wi.g.x = 0;
	wi.g.width = 305;
	wi.text = "containers[MENU_CONTAINER]";
	containers[MENU_CONTAINER] = gwinContainerCreate(0, &wi, 0);	
	
	// create container widget: containers[BLUETOOTH_CONTAINER]
	wi.g.x = 305;
	wi.g.width = 495;
	wi.text = "containers[BLUETOOTH_CONTAINER]";
	containers[BLUETOOTH_CONTAINER] = gwinContainerCreate(0, &wi, 0);
	
	// create container widget: containers[BLUETOOTH_SEARCH_CONTAINER]
	wi.g.x = 0;
	wi.g.y = 150;
	wi.g.height = 330;
	wi.g.parent = containers[BLUETOOTH_CONTAINER];
	wi.text = "containers[BLUETOOTH_SEARCH_CONTAINER]";
	containers[BLUETOOTH_SEARCH_CONTAINER] = gwinContainerCreate(0, &wi, 0);
	
	// create container widget: containers[BLUETOOTH_DEVICE_CONTAINER]
	wi.g.show = TRUE;
	wi.text = "containers[BLUETOOTH_DEVICE_CONTAINER]";
	containers[BLUETOOTH_DEVICE_CONTAINER] = gwinContainerCreate(0, &wi, 0);
	
	// create container widget: containers[GEARS_CONTAINER]
	wi.g.show = FALSE;
	wi.g.x = 305;
	wi.g.y = 0;
	wi.g.height = 480;
	wi.g.parent = containers[MAIN_CONTAINER];
	wi.text = "containers[GEARS_CONTAINER]";
	containers[GEARS_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);
	
	// create container widget: containers[TEETH_CONTAINER]
	wi.text = "containers[TEETH_CONTAINER]";
	containers[TEETH_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);
	
  // create container widget: containers[STATUS_CONTAINER]
	wi.text = "containers[STATUS_CONTAINER]";
	containers[STATUS_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);
	
	// create container widget: containers[CLOCK_CONTAINER]
	wi.text = "containers[CLOCK_CONTAINER]";
	containers[CLOCK_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);
}

static void createMap(void)
{
	TRACE("createMap\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);

	/*//create map window
  gwinSetDefaultBgColor(red_studio);
  GWindowInit windowInitStruct;
  windowInitStruct.x = 0;
  windowInitStruct.y = 0;
  windowInitStruct.width = 495;
  windowInitStruct.height = 480;
  windowInitStruct.show = TRUE;
  windowInitStruct.parent = containers[MAP_CONTAINER];
  mapWindow = gwinGWindowCreate(GDISP,NULL, &windowInitStruct);*/
	
	
	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 20;
	wi.g.y = 20;
	wi.g.width = 450;
	wi.g.height = 100;
	wi.g.parent = containers[MAP_CONTAINER];
	wi.text = "Hello";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[3] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[3], TRUE);
	gwinSetFont(labels[3], gdispOpenFont("Georgia24"));
	//gwinSetText(labels[3], gearsStatus, TRUE);
}

static void createData(void)
{
	TRACE("createData\n");
	GWidgetInit wi; 
	gwinWidgetClearInit(&wi);
		
	speed = 0;
	formatString(speedout, sizeof(speedout), "%d km/h", speed);
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 0;
	wi.g.width = 305;
	wi.g.height = 113;
	wi.g.parent = containers[DATA_CONTAINER];
	wi.text = speedout;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia60"));
	gwinRedraw(labels[0]);

	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 114;
	wi.g.width = 305;
	wi.g.height = 71;
	wi.g.parent = containers[DATA_CONTAINER];
	wi.text = "69 RPM";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	labels[1] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[1], TRUE);
	gwinSetFont(labels[1], gdispOpenFont("Georgia40"));
	gwinRedraw(labels[1]);
	
	// Create label widget: labels[2]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 366;
	wi.g.width = 117;
	wi.g.height = 114;
	wi.g.parent = containers[DATA_CONTAINER];
	wi.text = "100%";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	labels[2] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[2], TRUE);
	gwinSetFont(labels[2], gdispOpenFont("Georgia40"));
	gwinRedraw(labels[2]);
	
	// create button widget: buttons[0]
	wi.g.show = TRUE;
	wi.g.x = 126; // 117 + 9
	wi.g.y = 373; // 366 + 7
	wi.g.width = 170;
	wi.g.height = 100;
	wi.g.parent = containers[DATA_CONTAINER];
  wi.text = "Settings";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &belize;
	buttons[0] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[0], gdispOpenFont("Georgia36"));
	gwinRedraw(buttons[0]);
}

static void createMenu(void)
{
	TRACE("createMenu\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	// Create list widget: lists[0]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 0;
	wi.g.width = 305;
	wi.g.height = 400;
	wi.g.parent = containers[MENU_CONTAINER];
	wi.text = "lists[0]";
	wi.customDraw = gwinListDefaultDraw;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	lists[0] = gwinListCreate(0, &wi, FALSE);
	gwinSetFont(lists[0], gdispOpenFont("Georgia40"));
	gwinListSetScroll(lists[0], scrollSmooth);
	gwinListAddItem(lists[0], "Bluetooth", FALSE);
	gwinListAddItem(lists[0], "Gears Settings", FALSE);
	gwinListAddItem(lists[0], "Teeth Settings", FALSE);
	gwinListAddItem(lists[0], "Gears Status", FALSE);
	gwinListAddItem(lists[0], "Clock Settings", FALSE);
	gwinListSetSelected(lists[0], 0, TRUE);
	gwinListSetSelected(lists[0], 1, FALSE);
	gwinListSetSelected(lists[0], 2, FALSE);
	gwinListSetSelected(lists[0], 3, FALSE);
  gwinListSetSelected(lists[0], 4, FALSE);
	oldMenuSelectedItem = -1;
	
	// create button widget: buttons[0]
	wi.g.show = TRUE;
	wi.g.x = 50;
	wi.g.y = 410;
	wi.g.width = 200;
	wi.g.height = 60;
	wi.g.parent = containers[MENU_CONTAINER];
	wi.text = "Return";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &belize;
	buttons[0] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[0], gdispOpenFont("Georgia40"));
}

static void createBluetooth(void)
{
	TRACE("createBluetooth\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 45;
	wi.g.y = 100;
	wi.g.width = 405;
	wi.g.height = 100;
	wi.g.parent = containers[BLUETOOTH_SEARCH_CONTAINER];
	wi.text = "Searching";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia60"));
	gwinRedraw(labels[0]);
	
  // Create list widget: lists[1]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 0;
	wi.g.width = 495;
	wi.g.height = 330;
	wi.g.parent = containers[BLUETOOTH_DEVICE_CONTAINER];
	wi.text = "lists[1]";
	wi.customDraw = gwinListDefaultDraw;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	lists[1] = gwinListCreate(0, &wi, TRUE);
	gwinSetFont(lists[1], gdispOpenFont("Georgia60"));
	gwinListSetScroll(lists[1], scrollSmooth);
	gwinListAddItem(lists[1], "Device 0", FALSE);
	gwinListAddItem(lists[1], "Device 1", FALSE);
	gwinListAddItem(lists[1], "Device 2", FALSE);
	gwinListAddItem(lists[1], "Device 3", FALSE);
	gwinListAddItem(lists[1], "Device 4", FALSE);
	gwinListAddItem(lists[1], "Device 5", FALSE);
	gwinListAddItem(lists[1], "Device 6", FALSE);
	gwinListAddItem(lists[1], "Device 7", FALSE);
	gwinListAddItem(lists[1], "Device 8", FALSE);
	gwinListAddItem(lists[1], "Device 9", FALSE);
	gwinListSetSelected(lists[1], 0, TRUE);
	gwinListSetSelected(lists[1], 1, FALSE);
	gwinListSetSelected(lists[1], 2, FALSE);
	gwinListSetSelected(lists[1], 3, FALSE);
	gwinListSetSelected(lists[1], 4, FALSE);
	gwinListSetSelected(lists[1], 5, FALSE);
	gwinListSetSelected(lists[1], 6, FALSE);
	gwinListSetSelected(lists[1], 7, FALSE);
	gwinListSetSelected(lists[1], 8, FALSE);
	gwinListSetSelected(lists[1], 9, FALSE);
	
	// create button widget: buttons[1]
	wi.g.show = TRUE;
	wi.g.x = 150;
	wi.g.y = 25;
	wi.g.width = 195;
	wi.g.height = 100;
	wi.g.parent = containers[BLUETOOTH_CONTAINER];
	wi.text = "Search";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &belize;
	buttons[1] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[1], gdispOpenFont("Georgia40"));
}

static void createGearsSettings(void)
{
	TRACE("createGearsSettings\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 20;
	wi.g.y = 10;
	wi.g.width = 280;
	wi.g.height = 60;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "Number of Gears";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 65;
	wi.g.y = 80;
	wi.g.width = 160;
	wi.g.height = 60;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "Front";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[1] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[1], TRUE);
  gwinSetFont(labels[1], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[2]
	wi.g.show = TRUE;
	wi.g.x = 270;
	wi.g.y = 80;
	wi.g.width = 160;
	wi.g.height = 60;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "Back";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[2] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[2], TRUE);
	gwinSetFont(labels[2], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[3]
	wi.g.show = TRUE;
	wi.g.x = 105;
	wi.g.y = 160;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	formatString(gearBuffer, sizeof(gearBuffer), "%d", gearFrontSettings[0]);
	wi.text = gearBuffer;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[3] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[3], TRUE);
	gwinSetFont(labels[3], gdispOpenFont("Georgia36"));
	gwinSetText(labels[3], gearBuffer, TRUE);

	// create button widget: buttons[1]
	wi.g.show = TRUE;
	wi.g.x = 105;
	wi.g.y = 260;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "+";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[1] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[1], gdispOpenFont("Georgia36"));

	// create button widget: buttons[2]
	wi.g.show = TRUE;
	wi.g.x = 105;
	wi.g.y = 345;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "-";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[2] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[2], gdispOpenFont("Georgia36"));

	// Create label widget: labels[4]
	wi.g.show = TRUE;
	wi.g.x = 310;
	wi.g.y = 160;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	formatString(gearBuffer, sizeof(gearBuffer), "%d", gearBackSettings[0]);
	wi.text = gearBuffer;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[4] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[4], TRUE);
	gwinSetFont(labels[4], gdispOpenFont("Georgia36"));
	gwinSetText(labels[4], gearBuffer, TRUE);

	// create button widget: buttons[3]
	wi.g.show = TRUE;
	wi.g.x = 310;
	wi.g.y = 260;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "+";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[3] = gwinButtonCreate(0, &wi);
  gwinSetFont(buttons[3], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[4]
	wi.g.show = TRUE;
	wi.g.x = 310;
	wi.g.y = 345;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[GEARS_CONTAINER];
	wi.text = "-";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[4] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[4], gdispOpenFont("Georgia36"));
}

static void createTeethSettings(void)
{
	TRACE("createTeethSettings\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 20;
	wi.g.y = 5;
	wi.g.width = 350;
	wi.g.height = 60;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "Select Front or Back";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[5]
	wi.g.show = TRUE;
	wi.g.x = 65;
	wi.g.y = 70;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "F";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[5] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[5], gdispOpenFont("Georgia36"));

	// create button widget: buttons[6]
	wi.g.show = TRUE;
	wi.g.x = 150;
	wi.g.y = 70;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "B";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[6] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[6], gdispOpenFont("Georgia36"));

	// Create label widget: labels[4]
	wi.g.show = TRUE;
	wi.g.x = 240;
	wi.g.y = 70;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = (currentGearSide == 0 ? "F" : "B");
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[4] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[4], TRUE);
	gwinSetFont(labels[4], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 40;
	wi.g.y = 155;
	wi.g.width = 160;
	wi.g.height = 60;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "Gear";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[1] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[1], TRUE);
	gwinSetFont(labels[1], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[2]
	wi.g.show = TRUE;
	wi.g.x = 240;
	wi.g.y = 155;
	wi.g.width = 160;
	wi.g.height = 60;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "Teeth";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[2] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[2], TRUE);
	gwinSetFont(labels[2], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[3]
	wi.g.show = TRUE;
	wi.g.x = 90;
	wi.g.y = 220;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	formatString(gearBuffer, sizeof(gearBuffer), "%d", currentGearTeethWindow);
	wi.text = gearBuffer;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[3] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[3], TRUE);
	gwinSetFont(labels[3], gdispOpenFont("Georgia36"));
	gwinSetText(labels[3], gearBuffer, TRUE);
	
	// create button widget: buttons[1]
	wi.g.show = TRUE;
	wi.g.x = 90;
	wi.g.y = 305;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "+";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[1] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[1], gdispOpenFont("Georgia36"));

	// create button widget: buttons[2]
	wi.g.show = TRUE;
	wi.g.x = 90;
	wi.g.y = 390;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "-";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[2] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[2], gdispOpenFont("Georgia36"));

	// Create label widget: labels[5]
	wi.g.show = TRUE;
	wi.g.x = 280;
	wi.g.y = 220;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	formatString(gearBuffer, sizeof(gearBuffer), "%d", currentTeethTeethWindow);
	wi.text = gearBuffer;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[5] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[5], TRUE);
	gwinSetFont(labels[5], gdispOpenFont("Georgia36"));
	gwinSetText(labels[5], gearBuffer, TRUE);

	// create button widget: buttons[3]
	wi.g.show = TRUE;
	wi.g.x = 280;
	wi.g.y = 305;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "+";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[3] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[3], gdispOpenFont("Georgia36"));

	// create button widget: buttons[4]
	wi.g.show = TRUE;
	wi.g.x = 280;
	wi.g.y = 390;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "-";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[4] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[4], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[7]
	wi.g.show = TRUE;
	wi.g.x = 390;
	wi.g.y = 300;
	wi.g.width = 90;
	wi.g.height = 90;
	wi.g.parent = containers[TEETH_CONTAINER];
	wi.text = "Save";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[7] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[7], gdispOpenFont("Georgia36"));
}

static void createGearsStatus(void)
{
	TRACE("createGearsStatus\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);
	
	/*// create container widget: containers[STATUS_CONTAINER]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 0;
	wi.g.width = 495;
	wi.g.height = 240;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "containers[STATUS_CONTAINER]";
	wi.customDraw = 0;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	containers[STATUS_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);*/
	
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 5;
	wi.g.width = 160;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "Changes";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia36"));

	// create button widget: buttons[1]
	wi.g.show = TRUE;
	wi.g.x = 390;
	wi.g.y = 5;
	wi.g.width = 90;
	wi.g.height = 90;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "Submit";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[1] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[1], gdispOpenFont("Georgia24"));
	
	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 60;
	wi.g.width = 350;
	wi.g.height = 30;
	wi.g.parent = containers[STATUS_CONTAINER];
	formatString(gearsStatus, sizeof(gearsStatus), "Number of Front Gears = %d", gearFrontSettings[0]);
	wi.text = gearsStatus;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[1] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[1], TRUE);
	gwinSetFont(labels[1], gdispOpenFont("Georgia24"));
	gwinSetText(labels[1], gearsStatus, TRUE);
	
	// Create label widget: gearsChangesFrontGearLabel
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 95;
	wi.g.width = 50;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	
	for(int i = 1; i <= gearFrontSettings[0]; i++){
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearFrontSettings[i]);
		wi.text = gearBuffer;
		gearsChangesFrontGearLabel[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(gearsChangesFrontGearLabel[i], TRUE);
		gwinSetFont(gearsChangesFrontGearLabel[i], gdispOpenFont("Georgia24"));
		gwinSetText(gearsChangesFrontGearLabel[i], gearBuffer, TRUE);
		wi.g.x += 50;
	}
	
	// Create label widget: labels[2]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 150;
	wi.g.width = 350;
	wi.g.height = 30;
	wi.g.parent = containers[STATUS_CONTAINER];
	formatString(gearsStatus, sizeof(gearsStatus), "Number of Back Gears = %d", gearBackSettings[0]);
	wi.text = gearsStatus;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[2] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[2], TRUE);
	gwinSetFont(labels[2], gdispOpenFont("Georgia24"));
	gwinSetText(labels[2], gearsStatus, TRUE);
	
		// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 185;
	wi.g.width = 50;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	
	for(int i = 1; i <= gearBackSettings[0]; i++){
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearBackSettings[i]);
		wi.text = gearBuffer;
		gearsChangesBackGearLabel[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(gearsChangesBackGearLabel[i], TRUE);
		gwinSetFont(gearsChangesBackGearLabel[i], gdispOpenFont("Georgia24"));
		gwinSetText(gearsChangesBackGearLabel[i], gearBuffer, TRUE);
		wi.g.x += 50;
	}
	
	/*// create container widget: containers[STATUS_CONTAINER]
	wi.g.show = TRUE;
	wi.g.x = 0;
	wi.g.y = 240;
	wi.g.width = 495;
	wi.g.height = 240;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "containers[STATUS_CONTAINER]";
	wi.customDraw = 0;
	wi.customParam = 0;
	wi.customStyle = &midnight;
	containers[STATUS_CONTAINER] = gwinContainerCreate(0, &wi, GWIN_CONTAINER_BORDER);*/
	
	// Create label widget: labels[3]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 245;
	wi.g.width = 160;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "Current";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[3] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[3], TRUE);
	gwinSetFont(labels[3], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[2]
	wi.g.show = TRUE;
	wi.g.x = 390;
	wi.g.y = 245;
	wi.g.width = 90;
	wi.g.height = 90;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.text = "Read";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[2] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[2], gdispOpenFont("Georgia24"));
	
	// Create label widget: labels[4]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 300;
	wi.g.width = 350;
	wi.g.height = 30;
	wi.g.parent = containers[STATUS_CONTAINER];
	formatString(gearsStatus, sizeof(gearsStatus), "Number of Front Gears = %d", gearFrontSettings[0]);
	wi.text = gearsStatus;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[4] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[4], TRUE);
	gwinSetFont(labels[4], gdispOpenFont("Georgia24"));
	gwinSetText(labels[4], gearsStatus, TRUE);
	
	// Create label widget: gearsCurrentFrontGearLabel
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 335;
	wi.g.width = 50;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	
	for(int i = 1; i <= gearFrontSettings[0]; i++){
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearFrontSettings[i]);
		wi.text = gearBuffer;
		gearsCurrentFrontGearLabel[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(gearsCurrentFrontGearLabel[i], TRUE);
		gwinSetFont(gearsCurrentFrontGearLabel[i], gdispOpenFont("Georgia24"));
		gwinSetText(gearsCurrentFrontGearLabel[i], gearBuffer, TRUE);
		wi.g.x += 50;
	}
	
	// Create label widget: labels[5]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 390;
	wi.g.width = 350;
	wi.g.height = 30;
	wi.g.parent = containers[STATUS_CONTAINER];
	formatString(gearsStatus, sizeof(gearsStatus), "Number of Back Gears = %d", gearBackSettings[0]);
	wi.text = gearsStatus;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[5] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[5], TRUE);
	gwinSetFont(labels[5], gdispOpenFont("Georgia24"));
	gwinSetText(labels[5], gearsStatus, TRUE);
	
	// Create label widget: labels[4]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 425;
	wi.g.width = 50;
	wi.g.height = 50;
	wi.g.parent = containers[STATUS_CONTAINER];
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	
	for(int i = 1; i <= gearBackSettings[0]; i++){
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearBackSettings[i]);
		wi.text = gearBuffer;
		gearsCurrentBackGearLabel[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(gearsCurrentBackGearLabel[i], TRUE);
		gwinSetFont(gearsCurrentBackGearLabel[i], gdispOpenFont("Georgia24"));
		gwinSetText(gearsCurrentBackGearLabel[i], gearBuffer, TRUE);
		wi.g.x += 50;
	}
}

static void createClockSettings(void)
{
	TRACE("createClockSettings\n");
	GWidgetInit wi;
	gwinWidgetClearInit(&wi);

	clockChangeSelectedItem = 0;
	previousClockSelection = 0;
	clockChangesStruct.Year = 16;
	clockChangesStruct.Month = 10;
	clockChangesStruct.Day = 7;
	clockChangesStruct.Hours = 12;
	clockChangesStruct.Minutes = 15;
	
	// Create label widget: labels[0]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 5;
	wi.g.width = 160;
	wi.g.height = 50;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "Changes";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[0], TRUE);
	gwinSetFont(labels[0], gdispOpenFont("Georgia36"));

	// create button widget: buttons[1]
	wi.g.show = TRUE;
	wi.g.x = 390;
	wi.g.y = 5;
	wi.g.width = 90;
	wi.g.height = 90;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "Submit";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[1] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[1], gdispOpenFont("Georgia24"));
	
	// Create label widget: clockChangesKey
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 60;
	wi.g.width = 120;
	wi.g.height = 50;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "Yr";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	clockChangesKey[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(clockChangesKey[0], TRUE);
	gwinSetFont(clockChangesKey[0], gdispOpenFont("Georgia36"));
	
	for(int i = 1; i < 5; i++){
		wi.g.y += 55;
		switch(i){
		case 1:
			wi.text = "Mon";
			break;
		case 2:
			wi.text = "Day";
			break;
		case 3:
			wi.text = "Hou";
			break;
		case 4:
			wi.text = "Min";
			break;
		}
		clockChangesKey[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(clockChangesKey[i], TRUE);
		gwinSetFont(clockChangesKey[i], gdispOpenFont("Georgia36"));
	}
	
	// Create label widget: clockChangesValue
	wi.g.show = TRUE;
	wi.g.x = 136;
	wi.g.y = 60;
	wi.g.width = 120;
	wi.g.height = 50;
	wi.g.parent = containers[CLOCK_CONTAINER];
	formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Year);
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	clockChangesValue[0] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(clockChangesValue[0], TRUE);
	gwinSetFont(clockChangesValue[0], gdispOpenFont("Georgia36"));
	gwinSetText(clockChangesValue[0], timeBuffer, TRUE);
	
	for(int i = 1; i < 5; i++){
		wi.g.y += 55;
		switch(i){
		case 1:
			formatString(timeBuffer, sizeof(timeBuffer), "%d",clockChangesStruct.Month);
			break;
		case 2:
			formatString(timeBuffer, sizeof(timeBuffer), "%d",clockChangesStruct.Day);
			break;
		case 3:
			formatString(timeBuffer, sizeof(timeBuffer), "%d",clockChangesStruct.Hours);
			break;
		case 4:
			formatString(timeBuffer, sizeof(timeBuffer), "%d",clockChangesStruct.Minutes);
			break;
		}
		clockChangesValue[i] = gwinLabelCreate(0, &wi);
		gwinLabelSetBorder(clockChangesValue[i], TRUE);
		gwinSetFont(clockChangesValue[i], gdispOpenFont("Georgia36"));
		gwinSetText(clockChangesValue[i], timeBuffer, TRUE);
	}
	
	gwinSetStyle(clockChangesKey[clockChangeSelectedItem], &black);
	gwinSetStyle(clockChangesValue[clockChangeSelectedItem], &black);
	
	// create button widget: buttons[2]
	wi.g.show = TRUE;
	wi.g.x = 280;
	wi.g.y = 170;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "";
	wi.customDraw = gwinButtonDraw_ArrowUp;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[2] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[2], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[3]
	wi.g.show = TRUE;
	wi.g.x = 280;
	wi.g.y = 255;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "";
	wi.customDraw = gwinButtonDraw_ArrowDown;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[3] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[3], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[4]
	wi.g.show = TRUE;
	wi.g.x = 365;
	wi.g.y = 170;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "+";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[4] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[4], gdispOpenFont("Georgia36"));
	
	// create button widget: buttons[5]
	wi.g.show = TRUE;
	wi.g.x = 365;
	wi.g.y = 255;
	wi.g.width = 80;
	wi.g.height = 80;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "-";
	wi.customDraw = gwinButtonDraw_Rounded;
	wi.customParam = 0;
	wi.customStyle = &black;
	buttons[5] = gwinButtonCreate(0, &wi);
	gwinSetFont(buttons[5], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[1]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 360;
	wi.g.width = 160;
	wi.g.height = 50;
	wi.g.parent = containers[CLOCK_CONTAINER];
	wi.text = "Current";
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[1] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[1], TRUE);
	gwinSetFont(labels[1], gdispOpenFont("Georgia36"));
	
	// Create label widget: labels[2]
	wi.g.show = TRUE;
	wi.g.x = 15;
	wi.g.y = 415;
	wi.g.width = 465;
	wi.g.height = 50;
	wi.g.parent = containers[CLOCK_CONTAINER];
	getRTC(&RTCD, TM_RTC_Format_BIN);
	formatString(timeBuffer, sizeof(timeBuffer), "%d/%02d/%02d || %02d:%02d:%02d",RTCD.Year,RTCD.Month,RTCD.Day,RTCD.Hours,RTCD.Minutes,RTCD.Seconds);
	wi.text = timeBuffer;
	wi.customDraw = gwinLabelDrawJustifiedCenter;
	wi.customParam = 0;
	wi.customStyle = &belize;
	labels[2] = gwinLabelCreate(0, &wi);
	gwinLabelSetBorder(labels[2], TRUE);
	gwinSetFont(labels[2], gdispOpenFont("Georgia36"));
}

static void destroyMap(void)
{
	TRACE("destroyMap\n");
	gwinDestroy(labels[3]);
}

static void destroyData(void)
{
	TRACE("destroyData\n");
	gwinDestroy(labels[0]);
	gwinDestroy(labels[1]);
	gwinDestroy(labels[2]);
	gwinDestroy(buttons[0]);
}

static void destroyMenu(void)
{
	TRACE("destroyMenu\n");
	gwinDestroy(lists[0]);
	gwinDestroy(buttons[0]);
}

static void destroyBluetooth(void)
{
	TRACE("destroyBluetooth\n");
	gwinDestroy(labels[0]);
	gwinDestroy(lists[1]);
	gwinDestroy(buttons[1]);
	gwinDestroy(containers[BLUETOOTH_DEVICE_CONTAINER]);
	gwinDestroy(containers[BLUETOOTH_SEARCH_CONTAINER]);
	gwinHide(containers[BLUETOOTH_CONTAINER]);
}

static void destroyGearsSettings(void)
{
	TRACE("destroyGearsSettings\n");
	gwinDestroy(labels[0]);
	gwinDestroy(labels[1]);
	gwinDestroy(labels[2]);
	gwinDestroy(labels[3]);
	gwinDestroy(buttons[1]);
	gwinDestroy(buttons[2]);
	gwinDestroy(labels[4]);
	gwinDestroy(buttons[3]);
	gwinDestroy(buttons[4]);
	gwinHide(containers[GEARS_CONTAINER]);
}

static void destroyTeethSettings(void)
{
	TRACE("destroyTeethSettings\n");
	gwinDestroy(labels[0]);
	gwinDestroy(labels[1]);
	gwinDestroy(labels[2]);
	gwinDestroy(labels[3]);
	gwinDestroy(buttons[1]);
	gwinDestroy(buttons[2]);
	gwinDestroy(buttons[5]);
	gwinDestroy(buttons[6]);
	gwinDestroy(labels[4]);
	gwinDestroy(labels[5]);
	gwinDestroy(buttons[3]);
	gwinDestroy(buttons[4]);
	gwinDestroy(buttons[7]);
	gwinHide(containers[TEETH_CONTAINER]);
}

static void destroyGearsStatus(void)
{
	TRACE("destroyGearsStatus\n");
	for(int i = 1; i<= gearFrontSettings[0]; i++){
		gwinDestroy(gearsChangesFrontGearLabel[i]);
	}
	for(int i = 1; i<= gearBackSettings[0]; i++){
		gwinDestroy(gearsChangesBackGearLabel[i]);
	}
	gwinDestroy(labels[0]);
	gwinDestroy(buttons[1]);
	gwinDestroy(labels[1]);
	gwinDestroy(labels[2]);
	
	for(int i = 1; i<= gearFrontSettings[0]; i++){
		gwinDestroy(gearsCurrentFrontGearLabel[i]);
	}
	for(int i = 1; i<= gearBackSettings[0]; i++){
		gwinDestroy(gearsCurrentBackGearLabel[i]);
	}
	gwinDestroy(labels[3]);
	gwinDestroy(buttons[2]);
	gwinDestroy(labels[4]);
	gwinDestroy(labels[5]);
	
	gwinHide(containers[STATUS_CONTAINER]);
}

static void destroyClockSsettings(void)
{
	TRACE("destroyClockStatus\n");

	gwinDestroy(labels[0]);
	gwinDestroy(buttons[1]);
	
	for(int i = 0; i < 5; i++){
		gwinDestroy(clockChangesKey[i]);
	}
	
	for(int i = 0; i < 5; i++){
		gwinDestroy(clockChangesValue[i]);
	}
	
	gwinDestroy(labels[1]);
	gwinDestroy(labels[2]);
	
	gwinHide(containers[CLOCK_CONTAINER]);
}

static void destroyOldMenuSelectedItem(void)
{
	TRACE("destroyOldMenuSelectedItem\n");
	switch(oldMenuSelectedItem){
	case 0:
		destroyBluetooth();
		break;
	case 1:
		destroyGearsSettings();
		break;
	case 2:
		destroyTeethSettings();
		break;
	case 3:
		destroyGearsStatus();
		break;
	case 4:
		destroyClockSsettings();
		break;
	default:
		break;
	}
}

void saveTeethSettings(){
	TRACE("saveTeethSettings\n");
	if(currentGearSide == 0){
		if(!(currentGearTeethWindow < 1) && !(currentGearTeethWindow > MAXIMUM_FRONT_GEARS)){
			gearFrontSettings[currentGearTeethWindow] = currentTeethTeethWindow;
		}
	}else if(currentGearSide == 1){
		if(!(currentGearTeethWindow < 1) && !(currentGearTeethWindow > MAXIMUM_BACK_GEARS)){
			gearBackSettings[currentGearTeethWindow] = currentTeethTeethWindow;
		}
	}
}

void updateClockSelection(){
	gwinSetStyle(clockChangesKey[previousClockSelection], &belize);
	gwinSetStyle(clockChangesValue[previousClockSelection], &belize);
	gwinSetStyle(clockChangesKey[clockChangeSelectedItem], &black);
	gwinSetStyle(clockChangesValue[clockChangeSelectedItem], &black);
}

void guiShowPage(unsigned pageIndex)
{
	// Hide all pages
	gwinHide(containers[MAIN_CONTAINER]);

	// Show page selected page
	switch (pageIndex) {
	case 0:
		gwinShow(containers[MAIN_CONTAINER]);
		break;

	default:
		break;
	}
}

void guiCreate(void)
{
	openTraceFile();
	
	GWidgetInit wi;

	// GWIN settings
	gwinWidgetClearInit(&wi);
	gwinSetDefaultFont(gdispOpenFont("DejaVuSans16"));
	gwinSetDefaultStyle(&white, FALSE);
	gwinSetDefaultColor(black_studio);
	gwinSetDefaultBgColor(white_studio);
	
	gearFrontSettings[0] = 1;
	gearBackSettings[0] = 1;
	
	currentGearSide = 0;
	currentGearTeethWindow = 1;
	currentTeethTeethWindow = 25;
	
	// Create all the display pages
	createmainContainer();
	createMap();
	createData();
	
	// Select the default display page
	guiShowPage(0);
}

void guiEventLoop(void)
{
	GEvent* pe;
	int count = 0;
	uint8_t previousSeconds = 0;
	my_GPS gpsData;
	TM_GPS_Float_t GPS_Float_Lat;
	TM_GPS_Float_t GPS_Float_Lon;
	int tilex;
	int tiley;
	int tilexOffset;
	int tileyOffset;
	
//	int oldtilex=0;
//	int oldtiley=0;
	int oldtilexOffset=0;
	int oldtileyOffset=0;
	
	while (1) {		
		getRTC(&RTCD, TM_RTC_Format_BIN);
		uint32_t rtcTime = TM_RTC_GetUnixTimeStamp(&RTCD);
		uint32_t fileSavedTime = TM_RTC_GetUnixTimeStamp(&fileTime);
		if((rtcTime - fileSavedTime) > 300){
			closeTraceFile();
			openTraceFile();
		}
		
		if(gwinGetVisible(containers[DATA_CONTAINER])){
			if(count == 50){
				count = 0;
				speed++;
				if(speed == 200){
					speed = 0;
				}
				formatString(speedout, sizeof(speedout), "%d km/h", speed);
				gwinSetText(labels[0], speedout, TRUE);
			}else{
				count++;
			}
		}
		
		if(gwinGetVisible(containers[CLOCK_CONTAINER])){
			if(RTCD.Seconds != previousSeconds){
				formatString(timeBuffer, sizeof(timeBuffer), "%d/%02d/%02d || %02d:%02d:%02d",RTCD.Year,RTCD.Month,RTCD.Day,RTCD.Hours,RTCD.Minutes,RTCD.Seconds);
				gwinSetText(labels[2], timeBuffer, TRUE);
				previousSeconds = RTCD.Seconds;
			}
			if(clockChangeSelectedItem != previousClockSelection){
				updateClockSelection();
				previousClockSelection = clockChangeSelectedItem;
			}
		}
		
    if(gwinGetVisible(containers[MAP_CONTAINER])){
			gfxSleepMilliseconds(3);
			/*///gdispGClear(GDISP, (LUMA2COLOR(0)));
			gwinClear(mapWindow);
			x=x+2;y=y+2;
			for(int tempx = x+4*256; tempx>-256; tempx=tempx-256)
			{
					while(tempx > 4*256)
					{
							tempx=tempx-256;
					}
					for(int tempy = y+4*256; tempy>-256; tempy=tempy-256)
					{   
							while(tempy > 4*256)
							{
									tempy=tempy-256;
							}
							//drawTile(tempx, tempy);
							gwinDrawBox(mapWindow, tempx, tempy, 256, 256);
							
					}
			}*/
			gpsData = getGPS();	
#ifdef MAP_TILE_TEST_CANAL
			gpsData.Validity = true;
			gpsData.Latitude = 45.384365;
			gpsData.Longitude = -75.698600;
#endif
#ifdef MAP_TILE_TEST_MAYTHAM
			gpsData.Validity = true;
			gpsData.Latitude = 45.378962;
			gpsData.Longitude = -75.667347;
#endif
#ifdef MAP_TILE_TEST_JON
			gpsData.Validity = true;
			gpsData.Latitude = 45.409269;
			gpsData.Longitude = -75.706862;
#endif
			if(!gpsData.Validity){
				if(RTCD.Seconds != previousSeconds){
					formatString(gpsOutput, sizeof(gpsOutput),"GPS Data is Invalid");
					TRACE("GPS Data is Invalid\n");
					gwinSetText(labels[3], gpsOutput, TRUE);
					previousSeconds = RTCD.Seconds;
				}
			}else{
				if(RTCD.Seconds != previousSeconds){
					gwinHide(labels[3]);
					/* Latitude */
					/* Convert float to integer and decimal part, with 6 decimal places */
					//TM_GPS_ConvertFloat(gpsData.Latitude, &GPS_Float_Lat, 6);
					
					/* Longitude */
					/* Convert float to integer and decimal part, with 6 decimal places */
					//TM_GPS_ConvertFloat(gpsData.Longitude, &GPS_Float_Lon, 6);
					
					tilex = long2tilex(gpsData.Longitude, ZOOM_LEVEL, &tilexOffset);
					tiley = lat2tiley(gpsData.Latitude, ZOOM_LEVEL, &tileyOffset);
					
					//formatString(gpsOutput, sizeof(gpsOutput), "Latitude=%d.%d,Longitude=%d.%d", GPS_Float_Lat.Integer, GPS_Float_Lat.Decimal, GPS_Float_Lon.Integer, GPS_Float_Lon.Decimal);
					//formatString(gpsOutput, sizeof(gpsOutput), "Zoom=%d,TileX=%d,TileY=%d", ZOOM_LEVEL, tilex, tiley);
					TRACE("Zoom=%d,TileX=%d,TileY=%d\n", ZOOM_LEVEL, tilex, tiley);
					if((tilex != oldtilex) && (tiley != oldtiley)){
						drawTile(tilex, tiley, tilexOffset, tileyOffset);
						oldtilex=tilex;
						oldtiley=tiley;
						oldtilexOffset=tilexOffset;
						oldtileyOffset=tileyOffset;
					}
					
					previousSeconds = RTCD.Seconds;
				}
			}
		}
		
		// Get an event
		pe = geventEventWait(&glistener, 0);
		switch (pe->type) {
			case GEVENT_GWIN_BUTTON:
			{
				if (((GEventGWinButton*)pe)->gwin == buttons[0]) {
					button0Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[1]) {
					button1Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[2]) {
					button2Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[3]) {
					button3Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[4]){ 
					button4Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[5]){ 
					button5Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[6]){ 
					button6Call();
				}else if (((GEventGWinButton*)pe)->gwin == buttons[7]) {
					button7Call();
				}
				break;
			}
			default:
				break;
		}
		
		if(gwinGetVisible(containers[MENU_CONTAINER])){	
			handleMenuSwitches();
		}
	}
}

void button0Call(){
	if(gwinGetVisible(containers[DATA_CONTAINER])){
		destroyMap();
		destroyData();
		gwinHide(containers[DATA_CONTAINER]);
		gwinHide(containers[MAP_CONTAINER]);

		createMenu();
		gwinShow(containers[MENU_CONTAINER]);
	}else if(gwinGetVisible(containers[MENU_CONTAINER])){
		destroyOldMenuSelectedItem();
		destroyMenu();
		gwinHide(containers[MENU_CONTAINER]);
		
		createData();
		createMap();
		gwinShow(containers[DATA_CONTAINER]);
		gwinShow(containers[MAP_CONTAINER]);
		oldtilex=0;
		oldtiley=0;
	}
}

void button1Call(){
	if(gwinGetVisible(containers[BLUETOOTH_CONTAINER])){
		// BLUETOOTH SEARCH
		gwinHide(containers[BLUETOOTH_DEVICE_CONTAINER]);
		gwinShow(containers[BLUETOOTH_SEARCH_CONTAINER]);
		
		gfxSleepMilliseconds(5000);
		
		gwinHide(containers[BLUETOOTH_SEARCH_CONTAINER]);
		gwinShow(containers[BLUETOOTH_DEVICE_CONTAINER]);
	}else if(gwinGetVisible(containers[GEARS_CONTAINER])){
		// FRONT GEARS PLUS
		if(gearFrontSettings[0] != MAXIMUM_FRONT_GEARS){
			gearFrontSettings[0]++;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearFrontSettings[0]);
		gwinSetText(labels[3], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// GEAR PLUS TEETH
		if(currentGearSide == 0){
			if(currentGearTeethWindow < gearFrontSettings[0]){
				currentGearTeethWindow++;
			}
		}else if(currentGearSide == 1){
			if(currentGearTeethWindow < gearBackSettings[0]){
				currentGearTeethWindow++;
			}
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", currentGearTeethWindow);
		gwinSetText(labels[3], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[STATUS_CONTAINER])){
		// SUBMIT
		TRACE("Submit Gears\n");
	}else if(gwinGetVisible(containers[CLOCK_CONTAINER])){
		// Clock Changes Submit
		RTCD.Year = clockChangesStruct.Year;
		RTCD.Month = clockChangesStruct.Month;
		RTCD.Day = clockChangesStruct.Day;
		RTCD.Hours = clockChangesStruct.Hours;
		RTCD.Minutes = clockChangesStruct.Minutes;
		RTCD.Seconds = 0;
		updateRTC(&RTCD, TM_RTC_Format_BIN);
		//deleteTraceFile();
		closeTraceFile();
		openTraceFile();

	}	
}

void button2Call(){
	if(gwinGetVisible(containers[GEARS_CONTAINER])){
		// FRONT GEARS MINUS
		if(gearFrontSettings[0] != 1){
			gearFrontSettings[0]--;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearFrontSettings[0]);
		gwinSetText(labels[3], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// GEAR PLUS TEETH
		if(currentGearTeethWindow != 1){
			currentGearTeethWindow--;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", currentGearTeethWindow);
		gwinSetText(labels[3], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[STATUS_CONTAINER])){
		// READ
		TRACE("Read Gears\n");
	}else if(gwinGetVisible(containers[CLOCK_CONTAINER])){
		// Clock Changes Selection Up
		if(clockChangeSelectedItem != 0){clockChangeSelectedItem--;}
	}	
}

void button3Call(){
	if(gwinGetVisible(containers[GEARS_CONTAINER])){
		// BACK GEARS PLUS
		if(gearBackSettings[0] != MAXIMUM_BACK_GEARS){
			gearBackSettings[0]++;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearBackSettings[0]);
		gwinSetText(labels[4], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// TEETH PLUS TEETH
		if(currentTeethTeethWindow != MAXIMUM_TEETH){
			currentTeethTeethWindow++;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", currentTeethTeethWindow);
		gwinSetText(labels[5], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[CLOCK_CONTAINER])){
		// Clock Changes Selection Down
		if(clockChangeSelectedItem != 4){clockChangeSelectedItem++;}
	}	
}

void button4Call(){
	if(gwinGetVisible(containers[GEARS_CONTAINER])){
		// BACK GEARS MINUS
		if(gearBackSettings[0] != 1){
			gearBackSettings[0]--;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", gearBackSettings[0]);
		gwinSetText(labels[4], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// TEETH MINUS TEETH
		if(currentTeethTeethWindow != MINIMUM_TEETH){
			currentTeethTeethWindow--;
		}
		formatString(gearBuffer, sizeof(gearBuffer), "%d", currentTeethTeethWindow);
		gwinSetText(labels[5], gearBuffer, TRUE);
	}else if(gwinGetVisible(containers[CLOCK_CONTAINER])){
		// Clock Changes Selection Down
		switch(clockChangeSelectedItem){
			case 0:
				//if(clockChangeSelectedItem.Year)
				clockChangesStruct.Year++;
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Year);
				break;
			case 1:
				if(clockChangesStruct.Month != MAXIMUM_MONTH){clockChangesStruct.Month++;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Month);
				break;
			case 2:
				if(clockChangesStruct.Day != MAXIMUM_DAY){clockChangesStruct.Day++;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Day);
				break;
			case 3:
				if(clockChangesStruct.Hours != MAXIMUM_HOUR){clockChangesStruct.Hours++;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Hours);
				break;
			case 4:
				if(clockChangesStruct.Minutes != MAXIMUM_MINUTES){clockChangesStruct.Minutes++;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Minutes);
				break;
		}
		gwinSetText(clockChangesValue[clockChangeSelectedItem], timeBuffer, TRUE);
	}	
}

void button5Call(){
	if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// FRONT GEARS TEETH PAGE
		currentGearSide = 0;
		gwinSetText(labels[4], "F", TRUE);
		if(currentGearTeethWindow > gearFrontSettings[0]){
			currentGearTeethWindow = gearFrontSettings[0];
			formatString(gearBuffer, sizeof(gearBuffer), "%d", currentGearTeethWindow);
			gwinSetText(labels[3], gearBuffer, TRUE);
		}
	}else if(gwinGetVisible(containers[CLOCK_CONTAINER])){
		// Clock Changes Selection Down
		switch(clockChangeSelectedItem){
			case 0:
				clockChangesStruct.Year--;
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Year);
				break;
			case 1:
				if(clockChangesStruct.Month != 1){clockChangesStruct.Month--;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Month);
				break;
			case 2:
				if(clockChangesStruct.Day != 1){clockChangesStruct.Day--;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Day);
				break;
			case 3:
				if(clockChangesStruct.Hours != 0){clockChangesStruct.Hours--;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Hours);
				break;
			case 4:
				if(clockChangesStruct.Minutes != 0){clockChangesStruct.Minutes--;};
				formatString(timeBuffer, sizeof(timeBuffer), "%d", clockChangesStruct.Minutes);
				break;
		}
		gwinSetText(clockChangesValue[clockChangeSelectedItem], timeBuffer, TRUE);

	}	
}

void button6Call(){
	if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// BACK GEARS TEETH
		currentGearSide = 1;
		gwinSetText(labels[4], "B", TRUE);
		if(currentGearTeethWindow > gearBackSettings[0]){
			currentGearTeethWindow = gearBackSettings[0];
			formatString(gearBuffer, sizeof(gearBuffer), "%d", currentGearTeethWindow);
			gwinSetText(labels[3], gearBuffer, TRUE);
		}
	}	
}

void button7Call(){
	if(gwinGetVisible(containers[TEETH_CONTAINER])){
		// SAVE TEETH
		saveTeethSettings();
	}
}

void handleMenuSwitches(){
	if(oldMenuSelectedItem != gwinListGetSelected(lists[0])){
		destroyOldMenuSelectedItem();
		switch(gwinListGetSelected(lists[0])){
			case 0:
				createBluetooth();
				gwinShow(containers[BLUETOOTH_CONTAINER]);
				break;
			case 1:
				createGearsSettings();
				gwinShow(containers[GEARS_CONTAINER]);
				break;
			case 2:
				createTeethSettings();
				gwinShow(containers[TEETH_CONTAINER]);
				break;
			case 3:
				createGearsStatus();
				gwinShow(containers[STATUS_CONTAINER]);
				break;
			case 4:
				createClockSettings();
				gwinShow(containers[CLOCK_CONTAINER]);
				break;
			default:
				break;
		}
		oldMenuSelectedItem = gwinListGetSelected(lists[0]);
	}	
}

void drawTile(int tilex, int tiley, int tilexOffset, int tileyOffset)
{
	osStatus status;
	status  = osMutexWait(traceMutex, 0);
	if (status != osOK){
		// handle failure code
	}
    /*coord_t	swidth, sheight;
    swidth = gdispGetWidth();
	sheight = gdispGetHeight();
    gdispImageOpenFile(&myImage, "maptile_bmp.bmp");
	gdispImageDraw(&myImage, xx, yy, swidth, sheight, 0, 0);
    gdispImageClose(&myImage);*/
	coord_t leftX = 305;
	coord_t centerX = MAP_CENTERX-tilexOffset;
	coord_t rightX = MAP_CENTERX-tilexOffset+256;
	coord_t topY = 0;
	coord_t middleY = MAP_CENTERY-tileyOffset;
	coord_t bottomY = MAP_CENTERY-tileyOffset+256;
	coord_t xTileStartOffset = 256-247+tilexOffset;
	coord_t yTileStartOffset = 256-240+tileyOffset;
	coord_t xShowMap = 256 - xTileStartOffset;
	coord_t yShowMap = 256 - yTileStartOffset;
	
	// X11
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex-1, tiley-1);
	gdispImageOpenFile(&myImage[0], gpsOutput);
	gdispImageDraw(&myImage[0], leftX, topY, xShowMap, yShowMap, xTileStartOffset, yTileStartOffset);
	gdispImageClose(&myImage[0]);
	//gdispImageCache(&myImage[0]);
	
	// X9
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex-1, tiley);
	gdispImageOpenFile(&myImage[1], gpsOutput);
	gdispImageDraw(&myImage[1], leftX, middleY, xShowMap, 256, xTileStartOffset, 0);
	gdispImageClose(&myImage[1]);
	//gdispImageCache(&myImage[1]);
	
	// X10
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex-1, tiley+1);
	gdispImageOpenFile(&myImage[2], gpsOutput);
	gdispImageDraw(&myImage[2], leftX, bottomY, xShowMap, yTileStartOffset, xTileStartOffset, 0);
	gdispImageClose(&myImage[2]);
	//gdispImageCache(&myImage[2]);
	
	// X5
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex, tiley-1);
	gdispImageOpenFile(&myImage[3], gpsOutput);
	gdispImageDraw(&myImage[3], centerX, topY, 256, yShowMap, 0, yTileStartOffset);
	gdispImageClose(&myImage[3]);
	//gdispImageCache(&myImage[3]);
	
	// X1
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex, tiley);
	gdispImageOpenFile(&myImage[4], gpsOutput);
	gdispImageDraw(&myImage[4], centerX, middleY, 256, 256, 0, 0);
	gdispImageClose(&myImage[4]);
	//gdispImageCache(&myImage[4]);
	
	// X2
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex, tiley+1);
	gdispImageOpenFile(&myImage[5], gpsOutput);
	gdispImageDraw(&myImage[5], centerX, bottomY, 256, yTileStartOffset, 0, 0);
	gdispImageClose(&myImage[5]);
	//gdispImageCache(&myImage[5]);
	
	// X7
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex+1, tiley-1);
	gdispImageOpenFile(&myImage[6], gpsOutput);
	gdispImageDraw(&myImage[6], rightX, topY, xTileStartOffset, yShowMap, 0, yTileStartOffset);
	gdispImageClose(&myImage[6]);
	//gdispImageCache(&myImage[6]);

	// X3
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex+1, tiley);
	gdispImageOpenFile(&myImage[7], gpsOutput);
	gdispImageDraw(&myImage[7], rightX, middleY, xTileStartOffset, gdispGetHeight(), 0, 0);
	gdispImageClose(&myImage[7]);
	//gdispImageCache(&myImage[7]);
	
	// X4
	formatString(gpsOutput, sizeof(gpsOutput), "Tiles/%d/%d/%d.png", ZOOM_LEVEL, tilex+1, tiley+1);
	gdispImageOpenFile(&myImage[8], gpsOutput);
	gdispImageDraw(&myImage[8], rightX, bottomY, xTileStartOffset, yTileStartOffset, 0, 0);
	gdispImageClose(&myImage[8]);
	//gdispImageCache(&myImage[8]);
	
	gdispImageOpenFile(&marker, "Tiles/marker32.png");
	gdispImageDraw(&marker, MAP_CENTERX-16, MAP_CENTERY-32, gdispGetWidth(), gdispGetHeight(), 0, 0);
	gdispImageCache(&marker);
	//gdispImageClose(&marker);
	
	status = osMutexRelease(traceMutex);
	if (status != osOK)  {
		// handle failure code
	}
}